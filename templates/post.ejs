        
        <% posts.forEach(function(post, i){ %>
            <article id="post<%= i %>" class="post">
            <header>
            <a href="#post<%= i %>"><h1><%= post.title %></h1></a>
            <h2>Written by <a href="#"><%= post.username %></a> on <time><%= post.date %></time>.<h2>
            </header>
            <p>
            <%= post.body %>
            </p>
            </article>
            <% if (locals.user){ %>
            <%    if (locals.user.username == post.username) { %>
                <button id="deletePost<%= i %>" type="button">Delete</button>
                <button id="editPost<%= i %>" type="button">Edit</button>
            <% } } %>
        <% }); %>
        
        
        <script>
        // Accordion setup
        $(".post").accordion({ header: "h1" });
         
        // JavaScript to provide Edit/Delete button functionality
        if ("#deletePost<%= i %>").length){ // if this button exists, the other does to
            
            $("#deletePost<%= i %>").click(function(){
                $.ajax('/', {
                    data: { title: $("#post<%= i %>" h1).text(), 
                            username: <% locals.user.username ? locals.user.username : '' %>,
                            body: $("#post<%= i %>" p).text()
                          },
                    type: DELETE,
                    success: alert("Post deleted.")
                });
            });
            $("#editPost<%= i %>").click(function(){
                
                //Fill new post form fields with values from post
                
                $("#userField").val("<% locals.user.username ? locals.user.username : '' %>");
                $("#titleField").val("$("#post<%= i %>" h1).text()");
                $("#postField").val("$("#post<%= i %>" p).text()");
                
                //Change submit button to use Ajax method instead of default
                
                $("#postForm :submit").click(function( e ){
                    e.preventDefault();
                    $.ajax('/', {
                        data: { title: $("#post<%= i %>" h1).text, 
                                username: <% locals.user.username ? locals.user.username : '' %>,
                                body: $("#post<%= i %>" p).text
                            },
                        type: PUT,
                        success: alert("Post updated.")
                    });
                });                
            });
        }
        </script>


